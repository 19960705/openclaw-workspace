#!/usr/bin/env python3
"""
TikTok åˆ†é•œå¤´è„šæœ¬ç”Ÿæˆå™¨ - æ³°è¯­é«˜è½¬åŒ–å¹¿å‘Šç‰ˆ
ç”Ÿæˆç±»ä¼¼ Seedance é£æ ¼çš„è¯¦ç»†è„šæœ¬
"""
import json
import re
import requests
from datetime import datetime

# é…ç½®
XIAMAI_KEY = "sk-176ecb0ce05675d8fb2d55bda5da2524900a88392d92ecde4a83401a1defd48e"
XIAMAI_BASE = "http://ai.xiamai.top/v1"

def generate_tiktok_script(product_name, product_image_desc, duration=15):
    """
    ç”Ÿæˆæ³°è¯­ TikTok é«˜è½¬åŒ–å¹¿å‘Šè„šæœ¬
    
    Args:
        product_name: äº§å“åç§° (æ³°è¯­)
        product_image_desc: äº§å“å›¾ç‰‡æè¿°
        duration: è§†é¢‘æ—¶é•¿ (é»˜è®¤15ç§’)
    
    Returns:
        è¯¦ç»†çš„åˆ†é•œå¤´è„šæœ¬
    """
    
    prompt = f"""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ TikTok çŸ­è§†é¢‘ç¼–å¯¼ã€‚è¯·ä¸ºä»¥ä¸‹äº§å“ç”Ÿæˆæ³°è¯­é«˜è½¬åŒ–å¹¿å‘Šè„šæœ¬ï¼š

äº§å“åç§°: {product_name}
äº§å“æè¿°: {product_image_desc}
è§†é¢‘æ—¶é•¿: {duration} ç§’

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼ç”Ÿæˆï¼š

---
ã€è§†é¢‘æ ‡é¢˜å»ºè®®ã€‘ï¼ˆSeedanceç›´æ¥ç”¨ï¼‰

ã€æ•´ä½“é£æ ¼æŒ‡ä»¤ã€‘ï¼ˆæ”¾Seedanceæœ€å‰é¢ï¼‰
{duration}ç§’æ³°å›½TikToké«˜è½¬åŒ–å¹¿å‘Šï¼Œä½¿ç”¨æä¾›çš„å‚è€ƒå›¾ç‰‡ä½œä¸ºä¸»è§’ã€‚å¿…é¡»ç”¨20-28å²æ³°å›½ç”œç¾å¹´è½»å¥³ç”Ÿä¸»è§’ï¼ˆå¤§çœ¼ç›ã€ç¬‘å®¹ç”œã€æ´»åŠ›å¯çˆ±ï¼‰ï¼Œå‰3ç§’å¤§ç‰¹å†™ç¬‘å®¹+çœ¼ç¥ç›´è§†é•œå¤´ï¼Œæ¸©æš–é‡‘è‰²æ™¨å…‰ï¼Œ1080pç”µå½±æ„Ÿï¼Œæ‰€æœ‰å±å¹•æ–‡å­—å’Œæ—ç™½å¿…é¡»æ˜¯æ³°è¯­ï¼Œä¸“ä¸š+ç”œç¾æ»¡è¶³æ„Ÿæ‹‰æ»¡ã€‚

ã€åˆ†é•œå¤´è„šæœ¬ã€‘ï¼ˆå…±5ä¸ªé•œå¤´ï¼‰
é•œå¤´1ï¼ˆ0-{duration//5}ç§’ï¼‰
ç”»é¢ï¼š...
å±å¹•æ–‡æ¡ˆï¼ˆæ³°è¯­+emojiï¼‰ï¼š...
éŸ³æ•ˆï¼š...
æ—ç™½ï¼ˆæ³°è¯­å¹´è½»å¥³å£°ï¼‰ï¼š...

é•œå¤´2ï¼ˆ{duration//5}-{duration//5*2}ç§’ï¼‰
...

é•œå¤´3ï¼ˆ{duration//5*2}-{duration//5*3}ç§’ï¼‰
...

é•œå¤´4ï¼ˆ{duration//5*3}-{duration//5*4}ç§’ï¼‰
...

é•œå¤´5ï¼ˆ{duration//5*4}-{duration}ç§’ï¼‰
...
---

è¦æ±‚ï¼š
1. å¼€å¤´3ç§’å¿…é¡»æœ‰"é’©å­"æŠ“ä½æ³¨æ„åŠ›
2. ç»“å°¾å¿…é¡»æœ‰ CTA (è¡ŒåŠ¨å·å¬)
3. æ¯å¥å±å¹•æ–‡æ¡ˆéƒ½è¦æ³°è¯­ + emoji
4. æ—ç™½ç”¨æ³°å›½å¹´è½»å¥³å£°è¯­æ°”ï¼Œç”œç¾æ´»æ³¼
5. åŒ…å«äº§å“ç—›ç‚¹è§£å†³ï¼ˆbefore/afterå¯¹æ¯”ï¼‰
6. å¼ºè°ƒ "New Arrival" æˆ–ä¿ƒé”€æ ‡ç­¾
"""

    url = f"{XIAMAI_BASE}/responses"
    headers = {
        "Authorization": f"Bearer {XIAMAI_KEY}",
        "Content-Type": "application/json"
    }
    data = {
        "model": "gpt-5.3-codex",
        "input": [{
            "type": "message",
            "role": "user",
            "content": [{"type": "input_text", "text": prompt}]
        }]
    }
    
    try:
        r = requests.post(url, json=data, headers=headers, timeout=90)
        result = r.json()
        
        if "output" in result:
            content = result["output"][0].get("content", [{}])[0].get("text", "")
            return content
        return f"Error: {result}"
    except Exception as e:
        return f"Error: {str(e)}"

def format_for_seedance(script):
    """æ ¼å¼åŒ–è¾“å‡ºï¼Œæ–¹ä¾¿å¤åˆ¶åˆ° Seedance"""
    return f"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¬ SEEDANCE è„šæœ¬ - ç›´æ¥å¤åˆ¶ä½¿ç”¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{script}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ ä½¿ç”¨æ–¹æ³•ï¼š
1. å¤åˆ¶ã€è§†é¢‘æ ‡é¢˜å»ºè®®ã€‘åˆ° Seedance æ ‡é¢˜
2. å¤åˆ¶ã€æ•´ä½“é£æ ¼æŒ‡ä»¤ã€‘åˆ° Seedance é£æ ¼æè¿°
3. å¤åˆ¶æ¯ä¸ªé•œå¤´åˆ°å¯¹åº”çš„åœºæ™¯æè¿°
4. ç”Ÿæˆè§†é¢‘åç”¨æ³°è¯­é…éŸ³
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

# æµ‹è¯•
if __name__ == "__main__":
    print("ğŸ¬ TikTok æ³°è¯­å¹¿å‘Šè„šæœ¬ç”Ÿæˆå™¨\n")
    
    product = "à¹à¸à¹‰à¸§à¸ªà¹à¸•à¸™à¹€à¸¥à¸ªà¹€à¸­à¸ªà¹€à¸à¸£à¸ªà¹‚à¸‹ à¸«à¸¹à¸šà¸£à¸²à¸§"
    desc = "ä¸é”ˆé’¢æ„å¼èƒå–æ¯ï¼Œå¸¦é˜²çƒ«æ›²æŸ„ï¼Œä¿æ¸©ä¸çƒ«æ‰‹"
    
    print(f"äº§å“: {product}")
    print(f"æè¿°: {desc}\n")
    print("â³ ç”Ÿæˆä¸­...\n")
    
    script = generate_tiktok_script(product, desc, duration=15)
    print(format_for_seedance(script))
